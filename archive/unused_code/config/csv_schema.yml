# Final CSV Schema Configuration
# Defines the structure of the analysis-ready dataset

# Main Books Dataset (one row per book)
books_schema:
  filename: "romance_books_cleaned.csv"
  description: "Clean book metadata with subgenre classification and popularity metrics"
  
  columns:
    # Primary identifiers
    - name: book_id
      dtype: string
      description: "Unique book identifier"
      source: "goodreads_books_romance.json.gz"
      
    - name: work_id
      dtype: string
      description: "Work identifier for deduplication"
      source: "goodreads_books_romance.json.gz"
      
    - name: author_id
      dtype: string
      description: "Author identifier"
      source: "goodreads_book_authors.json.gz"
      
    - name: author_name
      dtype: string
      description: "Author name"
      source: "goodreads_book_authors.json.gz"
      
    # Book metadata
    - name: title
      dtype: string
      description: "Book title"
      source: "goodreads_books_romance.json.gz"
      
    - name: description
      dtype: string
      description: "Book description for NLP analysis"
      source: "goodreads_books_romance.json.gz"
      
    - name: publication_year
      dtype: int
      description: "Publication year (earliest edition as proxy for original)"
      source: "goodreads_books_romance.json.gz"
      
    - name: decade
      dtype: string
      description: "Decade category (2000-2009, 2010-2017)"
      derived: true
      
    - name: language_code
      dtype: string
      description: "Language code (filtered to 'eng')"
      source: "goodreads_books_romance.json.gz"
      
    # Popularity metrics (work-level aggregated)
    - name: average_rating_weighted_mean
      dtype: float
      description: "Weighted mean of average ratings across editions (weighted by ratings count)"
      derived: true
      
    - name: ratings_count_sum
      dtype: int
      description: "Total number of ratings across all editions of the work"
      derived: true
      
    - name: text_reviews_count_sum
      dtype: int
      description: "Total number of text reviews across all editions of the work"
      derived: true
      
    # Edition-level aggregations
    - name: num_pages_median
      dtype: float
      description: "Median page count across all editions of the work"
      derived: true
      
    - name: average_rating_weighted_median
      dtype: float
      description: "Weighted median of average ratings across editions (weighted by ratings count)"
      derived: true
      
    # Subgenre classification
    - name: subgenre_primary
      dtype: string
      description: "Primary subgenre classification from popular_shelves"
      derived: true
      
    - name: subgenre_keywords
      dtype: string
      description: "Keyword-based subgenre classification"
      derived: true
      
    - name: subgenre_final
      dtype: string
      description: "Final subgenre classification (primary + validation)"
      derived: true
      
    - name: subgenre_confidence
      dtype: float
      description: "Confidence score for subgenre classification (0-1)"
      derived: true
      
    # Raw classification data
    - name: popular_shelves
      dtype: string
      description: "JSON string of popular shelves for validation"
      source: "goodreads_books_romance.json.gz"
      
    - name: genre_tags
      dtype: string
      description: "JSON string of genre tags for validation"
      source: "goodreads_book_genres_initial.json.gz"
      
    # Optional metadata
    - name: num_pages
      dtype: int
      description: "Number of pages (optional)"
      source: "goodreads_books_romance.json.gz"
      
    - name: format
      dtype: string
      description: "Book format (optional)"
      source: "goodreads_books_romance.json.gz"
      
    - name: publisher
      dtype: string
      description: "Publisher (optional)"
      source: "goodreads_books_romance.json.gz"
      
    # Series information
    - name: series_id
      dtype: string
      description: "Series identifier (optional)"
      source: "goodreads_book_series.json.gz"
      
    - name: series_title
      dtype: string
      description: "Series title (optional)"
      source: "goodreads_book_series.json.gz"
      
    - name: series_position
      dtype: int
      description: "Position in series (optional)"
      source: "goodreads_book_series.json.gz"
      
    # Author metrics
    - name: author_average_rating
      dtype: float
      description: "Author's average rating"
      source: "goodreads_book_authors.json.gz"
      
    - name: author_ratings_count
      dtype: int
      description: "Author's total ratings count"
      source: "goodreads_book_authors.json.gz"
      
    # Quality indicators
    - name: has_description
      dtype: bool
      description: "Whether book has description"
      derived: true
      
    - name: quality_score
      dtype: float
      description: "Overall data quality score (0-1)"
      derived: true

# Reviews Dataset (one row per review)
reviews_schema:
  filename: "romance_reviews_cleaned.csv"
  description: "Clean review data with book associations"
  
  columns:
    # Primary identifiers
    - name: review_id
      dtype: string
      description: "Unique review identifier"
      source: "goodreads_reviews_romance.json.gz"
      
    - name: book_id
      dtype: string
      description: "Book identifier for joining"
      source: "goodreads_reviews_romance.json.gz"
      
    - name: user_id
      dtype: string
      description: "Anonymized user identifier"
      source: "goodreads_reviews_romance.json.gz"
      
    # Review content
    - name: review_text
      dtype: string
      description: "Review text for NLP analysis"
      source: "goodreads_reviews_romance.json.gz"
      
    - name: rating
      dtype: int
      description: "User rating (0-5 scale)"
      source: "goodreads_reviews_romance.json.gz"
      
    # Engagement metrics
    - name: n_votes
      dtype: int
      description: "Number of helpful votes"
      source: "goodreads_reviews_romance.json.gz"
      
    - name: n_comments
      dtype: int
      description: "Number of comments"
      source: "goodreads_reviews_romance.json.gz"
      
    # Temporal data
    - name: date_added
      dtype: string
      description: "Date review was added"
      source: "goodreads_reviews_romance.json.gz"
      
    - name: date_updated
      dtype: string
      description: "Date review was last updated"
      source: "goodreads_reviews_romance.json.gz"
      
    - name: read_at
      dtype: string
      description: "Date book was read (optional)"
      source: "goodreads_reviews_romance.json.gz"
      
    # Derived fields
    - name: review_length
      dtype: int
      description: "Length of review text in characters"
      derived: true
      
    - name: review_year
      dtype: int
      description: "Year review was added"
      derived: true
      
    - name: is_helpful
      dtype: bool
      description: "Whether review has helpful votes"
      derived: true

# Subgenre Classification Dataset (for validation)
subgenre_classification_schema:
  filename: "subgenre_classification_details.csv"
  description: "Detailed subgenre classification results for validation"
  
  columns:
    - name: book_id
      dtype: string
      description: "Book identifier"
      
    - name: title
      dtype: string
      description: "Book title"
      
    - name: subgenre_primary
      dtype: string
      description: "Primary classification from shelves"
      
    - name: subgenre_keywords
      dtype: string
      description: "Keyword-based classification"
      
    - name: subgenre_final
      dtype: string
      description: "Final classification"
      
    - name: confidence_score
      dtype: float
      description: "Classification confidence"
      
    - name: primary_keywords_matched
      dtype: string
      description: "Keywords that matched for primary classification"
      
    - name: keyword_keywords_matched
      dtype: string
      description: "Keywords that matched for keyword classification"
      
    - name: validation_notes
      dtype: string
      description: "Notes about classification validation"

# Data Quality Report
quality_report_schema:
  filename: "data_quality_report.csv"
  description: "Quality metrics for the final dataset"
  
  columns:
    - name: metric_name
      dtype: string
      description: "Quality metric name"
      
    - name: metric_value
      dtype: float
      description: "Metric value"
      
    - name: threshold
      dtype: float
      description: "Quality threshold"
      
    - name: status
      dtype: string
      description: "Pass/Fail status"
      
    - name: notes
      dtype: string
      description: "Additional notes"
