# Sampling and balancing rules for the romance subcorpus
# Updated to reflect actual implementation status

# Quality filters (IMPLEMENTED)
quality_filters:
  publication_year_min: 2000  # Modern books only
  publication_year_max: 2020  # Books up to 2020
  language_code: "eng"        # English language only (eng or en-* patterns)
  # ratings_count_min: 10     # REMOVED - no longer using ratings threshold
  # description_completeness: 0.8  # REMOVED - no longer requiring descriptions
  status: "✅ IMPLEMENTED"

# Author balancing (IMPLEMENTED)
author_limits:
  max_books_per_author: 1     # Limit prolific authors for thematic diversity
  random_seed: 42             # For reproducible sampling
  status: "✅ IMPLEMENTED"
  implementation: "AuthorBalancer class in quality_filters.py"

# Decade stratification (IMPLEMENTED)
decade_stratification:
  decades:
    - "2000-2009"
    - "2010-2017"
  target_books_per_decade: 1000  # Adjust based on available data
  status: "✅ IMPLEMENTED"
  implementation: "DecadeStratifier class in quality_filters.py"

# Edition aggregation (IMPLEMENTED)
edition_aggregation:
  group_by_work_id: true      # Group editions by work_id
  aggregation_methods:
    num_pages: "median"        # Median page count across editions
    ratings_count: "sum"       # Total ratings across editions
    text_reviews_count: "sum"  # Total text reviews across editions
    average_rating: "weighted_mean"  # Weighted by ratings count
  status: "✅ IMPLEMENTED"
  implementation: "calculate_edition_aggregations in data_integrator.py"

# Review sampling (IMPLEMENTED)
review_sampling:
  min_reviews_per_book: 1     # At least one review per book
  max_reviews_per_book: 100   # Limit to prevent bias toward popular books
  random_seed: 42             # For reproducible sampling
  status: "✅ IMPLEMENTED"
  implementation: "sample_reviews_data in data_integrator.py"

# Data processing pipeline (PARTIALLY IMPLEMENTED)
pipeline_steps:
  1: "quality_filtering"      # Apply quality filters
  2: "author_balancing"       # Limit books per author
  3: "decade_stratification"  # Balance across decades
  4: "books_data_integration" # Integrate books with edition aggregations
  5: "review_sampling"        # Sample reviews
  6: "subgenre_placeholder"   # Create placeholder subgenre fields
  7: "csv_export"            # Export to CSV
  status: "✅ IMPLEMENTED (7/13 steps)"

# MISSING FEATURES (NOT IMPLEMENTED)
missing_features:
  # Author data integration (IMPLEMENTED)
  author_data_integration:
    description: "Join author metadata from goodreads_book_authors.json.gz"
    required_fields:
      - author_id
      - author_name
      - author_average_rating
      - author_ratings_count
    status: "✅ IMPLEMENTED"
    impact: "High - author analysis now possible"
    priority: 1
    implementation: "integrate_author_data method in data_integrator.py"

  # Series data integration (OPTIONAL MISSING)
  series_data_integration:
    description: "Join series metadata from goodreads_book_series.json.gz"
    optional_fields:
      - series_id
      - series_title
      - series_position
    status: "❌ NOT IMPLEMENTED"
    impact: "Medium - series analysis not possible"
    priority: 1

  # Subgenre classification (CRITICAL MISSING)
  subgenre_classification:
    description: "Classify books into target subgenres"
    primary_source: "popular_shelves"    # Use shelves as primary source
    secondary_source: "book_genres_initial"  # Use genres as validation
    target_subgenres:
      - "contemporary_romance"
      - "historical_romance"
      - "paranormal_romance"
      - "romantic_suspense"
      - "romantic_fantasy"
      - "science_fiction_romance"
    target_books_per_subgenre: 500
    status: "❌ NOT IMPLEMENTED (PLACEHOLDER ONLY)"
    impact: "High - core research objective"
    priority: 4

  # Quality threshold enforcement (MISSING)
  quality_thresholds:
    completeness:
      required_fields: 0.95  # 95% of required fields must be present
      description_field: 0.8  # 80% of books must have descriptions
      publication_year: 0.9   # 90% must have publication year
    consistency:
      subgenre_classification: 0.8  # 80% confidence in subgenre classification
      author_consistency: 0.95      # 95% author data consistency
    distribution:
      subgenre_balance: 0.1         # No subgenre should have <10% of books
      decade_balance: 0.3           # Each decade should have 30-70% of books
      rating_distribution: "normal" # Ratings should follow normal distribution
    relationships:
      book_review_ratio: 0.8        # 80% of books should have reviews
      author_book_ratio: 0.9        # 90% of authors should have book data
    status: "❌ NOT IMPLEMENTED"
    impact: "Medium - data quality not enforced"
    priority: 2

  # Final validation and reporting (MISSING)
  final_validation:
    description: "Validate final dataset quality and generate reports"
    validation_checks:
      - completeness_check
      - consistency_check
      - distribution_check
      - relationship_check
    output: "data_quality_report.csv"
    status: "❌ NOT IMPLEMENTED"
    impact: "Medium - no quality reporting"
    priority: 3

# Implementation Status Summary
implementation_status:
  total_features: 12
  implemented_features: 6
  missing_features: 6
  completion_percentage: 50
  
  critical_missing:
    - "Author data integration (author_id, author_name)"
    - "Subgenre classification (core research objective)"
    - "Series data integration"
    - "Quality threshold enforcement"
    - "Final validation and reporting"
  
  next_priorities:
    1: "Add series data integration"
    2: "Implement quality threshold enforcement"
    3: "Add final validation and reporting"
    4: "Implement subgenre classification"
    5: "Add genre validation data"

# Data handling guarantees (IMPLEMENTED)
data_handling:
  raw_inputs_readonly: true   # Raw inputs are read-only
  interim_outputs: "data/intermediate/"  # Interim scratch outputs
  final_outputs: "data/processed/"       # Final cleaned subsets
  artifacts: "artifacts/"     # Schemas, samples
  logs: "logs/"              # Application logs
  status: "✅ IMPLEMENTED"

# Academic use constraints (IMPLEMENTED)
academic_constraints:
  source: "UCSD Goodreads Book Graph"
  restrictions:
    - "Scraped public shelves"
    - "Anonymized IDs"
    - "No redistribution"
    - "Non-commercial only"
  status: "✅ IMPLEMENTED"
  implementation: "Respected in all data processing"
